import{j as r,f as v,g as E,h as S,c as A,q as T,r as g,H as C,i as f}from"./index-D9A7aE9K.js";function I({badge:e}){const{title:s,description:a,status:t,progress:o=0,iconUrl:l}=e,c={earned:{label:"획득",className:"bg-brand-mint/10 text-brand-mint"},in_progress:{label:"진행",className:"bg-blue-500/10 text-blue-500"},locked:{label:"잠김",className:"bg-gray-10 text-gray-60"}}[t],d={"--p":`${o}%`};return r.jsxs("article",{className:["relative","flex min-h-[10rem] flex-col gap-[1rem] rounded-[8px] px-[1.3rem] pb-[1.2rem] pt-[1.8rem] outline-none","bg-white shadow-sm focus-visible:ring-2 focus-visible:ring-brand-mint",t==="locked"?"opacity-70":"opacity-100"].join(" "),"aria-label":`${s} 뱃지`,children:[r.jsx("span",{className:["pointer-events-none","absolute right-[1rem] top-[1rem]","rounded-[6px] px-[0.5rem] py-[0.3rem] font-semibold ct6",c.className].join(" "),children:c.label}),r.jsx("div",{className:"flex items-center justify-start",children:r.jsxs("div",{className:"flex items-center gap-[0.6rem]",children:[r.jsx("div",{className:"flex h-[3rem] w-[3rem] items-center justify-center overflow-hidden rounded-[8px] bg-gray-5",children:l?r.jsx("img",{src:l,alt:"",className:"h-full w-full object-cover"}):r.jsx(v,{className:"h-[2rem] w-[2rem] text-gray-50"})}),r.jsxs("div",{className:"flex flex-col gap-[0.4rem]",children:[r.jsx("h3",{className:"text-gray-90 ct3",children:s}),r.jsx("p",{className:"text-gray-60 ct5",children:a})]})]})}),t==="in_progress"&&r.jsx("div",{className:"flex flex-col gap-[0.4rem]",style:d,children:r.jsx("div",{className:"h-[0.8rem] w-full rounded-[6px] bg-gray-10",children:r.jsx("div",{className:"h-full w-[var(--p)] rounded-[6px] bg-blue-500"})})}),t!=="in_progress"&&r.jsx("div",{className:"flex items-center justify-end",children:t==="earned"?r.jsx(E,{className:"h-[2rem] w-[2rem] text-brand-mint","aria-label":"획득 완료"}):r.jsx(S,{className:"h-[2rem] w-[2rem] text-gray-40","aria-label":"잠김"})})]})}function p(e,s={}){return A({queryKey:["myBadges",e??"ALL"],queryFn:T.myBadges(e),enabled:s.enabled??!0})}const _={ACHIEVED:"earned",IN_PROGRESS:"in_progress",LOCKED:"locked"},h=/^badge\.app\.open\.(\d+)$/,y=/^badge\.app\.streak\.(\d+)$/;function j(e,s){const a=h.exec(e);if(a)return`접속 ${Number(a[1])}회`;const t=y.exec(e);return t?`${Number(t[1])}일 연속 접속`:s}function B(e){const s=new Date(e);return new Intl.DateTimeFormat("ko-KR",{timeZone:"Asia/Seoul",year:"numeric",month:"long",day:"numeric"}).format(s)}function R(e){if(e.status==="ACHIEVED")return e.awardedAt?`${B(e.awardedAt)} 획득`:"획득 완료";if(e.status==="IN_PROGRESS")return e.goalValue>0?`${e.currentValue}/${e.goalValue} 진행 중`:"진행 중";const s=h.exec(e.code);if(s)return`앱을 ${Number(s[1])}번 열면 획득`;const a=y.exec(e.code);return a?`${Number(a[1])}일 연속 접속하면 획득`:"달성 조건을 완료하면 획득"}function O(e,s,a){return e<s?s:e>a?a:e}function $(e){if(e.status==="ACHIEVED")return 100;if(e.goalValue>0){const s=Math.round(e.currentValue/e.goalValue*100);return O(s,0,100)}}function V(e){return e?j(e.code,e.title):"다음 목표 없음"}function F(e){return e.badges.map(s=>({id:s.code,title:j(s.code,s.title),description:R(s),status:_[s.status],progress:$(s),earnedAt:s.awardedAt,iconUrl:void 0}))}const K=[{key:"all",label:"전체"},{key:"earned",label:"획득"},{key:"in_progress",label:"진행중"},{key:"locked",label:"잠김"}],M={all:void 0,earned:"ACHIEVED",in_progress:"IN_PROGRESS",locked:"LOCKED"},P=["sk-1","sk-2","sk-3","sk-4","sk-5","sk-6"];function L(){return r.jsxs("div",{className:"col-span-2 flex flex-col items-center gap-[1.2rem] rounded-[8px] bg-white p-[2rem] text-center shadow-sm",children:[r.jsx(f,{className:"h-[3.2rem] w-[3.2rem] text-gray-40"}),r.jsx("p",{className:"text-gray-80 ct2",children:"아직 해당 뱃지가 없어요"}),r.jsx("p",{className:"text-gray-60 ct4",children:"전시를 감상하거나 수집해 보세요."})]})}function D(){return r.jsx(r.Fragment,{children:P.map(e=>r.jsx("div",{className:"animate-pulse h-[10rem] rounded-[8px] bg-gray-5"},e))})}function q(){const[e,s]=g.useState("all"),a=g.useMemo(()=>M[e],[e]),{data:t,isFetching:o,isError:l}=p(),{data:c,isFetching:d,isError:b}=p(a,{enabled:e!=="all"}),m=e==="all"?t:c,i=e==="all"?o:d,u=e==="all"?l:b,x=g.useMemo(()=>m?F(m):[],[m]),N=(t==null?void 0:t.acquired)??0,k=(t==null?void 0:t.total)??0,w=V(t==null?void 0:t.nextTarget);return r.jsxs("main",{className:"flex w-full flex-col",children:[r.jsx(C,{title:"나의 뱃지",showBackButton:!0,backgroundColorClass:"bg-gray-5"}),r.jsx("section",{className:"px-[2.4rem] py-[2rem]",children:r.jsxs("div",{className:"flex items-center justify-between rounded-[8px] bg-white p-[1.6rem] shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-[1.2rem]",children:[r.jsx("div",{className:"flex h-[4rem] w-[4rem] items-center justify-center rounded-[8px] bg-brand-mint/10",children:r.jsx(f,{className:"h-[2.4rem] w-[2.4rem] text-brand-mint"})}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("p",{className:"text-gray-60 ct3",children:"획득한 뱃지"}),r.jsxs("p",{className:"text-gray-90 t3",children:[r.jsx("span",{className:"text-brand-mint",children:N})," /"," ",k]})]})]}),r.jsxs("p",{className:"text-gray-60 ct3",children:["다음 목표: ",r.jsx("span",{className:"text-gray-80",children:w})]})]})}),r.jsx("nav",{"aria-label":"뱃지 필터",className:"px-[2.4rem]",children:r.jsx("ul",{className:"flex gap-[0.8rem]",children:K.map(n=>r.jsx("li",{children:r.jsx("button",{type:"button",onClick:()=>s(n.key),"aria-pressed":e===n.key,className:["rounded-[6px] px-[1.2rem] py-[0.6rem] ct3",e===n.key?"bg-gray-90 text-white":"bg-gray-10 text-gray-70 hover:bg-gray-20/50","focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-mint"].join(" "),children:n.label})},n.key))})}),r.jsxs("section",{className:"mt-[1.6rem] grid grid-cols-2 gap-[0.8rem] px-[2.4rem] pb-[4rem]",children:[i&&r.jsx(D,{}),!i&&!u&&x.length===0&&r.jsx(L,{}),!i&&!u&&x.length>0&&x.map(n=>r.jsx(I,{badge:n},n.id)),!i&&u&&r.jsx("div",{className:"col-span-2 rounded-[8px] bg-white p-[1.6rem] text-center text-red-500 shadow-sm ct3",children:"뱃지를 불러오지 못했어요."})]})]})}export{q as default};
