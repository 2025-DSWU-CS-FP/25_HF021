import{j as t,r as l,I as T,c as B,q as D,a as $,p as q,o as j,v as I,H as L,s as R}from"./index-D9A7aE9K.js";import{S as V,E as A}from"./ExhibitionGrid-CN8zCLR1.js";function U({filter:s,onFilterChange:e}){const n=s==="전체",a=s==="즐겨찾기",r="rounded-[6px] px-[1.2rem] py-[0.8rem] ct3",c="bg-gray-90 text-white",d="bg-gray-0 text-gray-60";return t.jsxs("div",{className:"flex gap-[0.8rem]",children:[t.jsx("button",{type:"button","aria-pressed":n,className:`${r} ${n?c:d}`,onClick:()=>e("전체"),children:"전체"}),t.jsx("button",{type:"button","aria-pressed":a,className:`${r} ${a?c:d}`,onClick:()=>e(a?"전체":"즐겨찾기"),children:"즐겨찾기만"})]})}function G({sort:s,onChange:e,options:n}){const[a,r]=l.useState(!1),c=l.useRef(null);l.useEffect(()=>{const o=m=>{c.current&&!c.current.contains(m.target)&&r(!1)};return a&&document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[a]);const d=o=>{e(o),r(!1)};return t.jsxs("div",{className:"relative z-10",ref:c,children:[t.jsxs("button",{type:"button",onClick:()=>r(!a),"aria-expanded":a,"aria-haspopup":"listbox","aria-label":"정렬 옵션 선택",className:"flex items-center gap-[0.4rem] rounded-[6px] bg-gray-0 px-[1.2rem] py-[0.8rem] text-gray-60 ct3",children:[s,t.jsx(T,{className:"text-gray-60"})]}),a&&t.jsx("div",{className:"absolute right-0 top-full mt-2 w-full overflow-hidden rounded-[5px] bg-gray-0 shadow-md",role:"listbox","aria-label":"정렬 옵션",children:n.map((o,m)=>{const g=m===0,p=m===n.length-1;return t.jsx("button",{type:"button",className:`w-full cursor-pointer px-[1.2rem] py-[0.8rem] text-left text-gray-60 ct3 hover:bg-gray-5 ${g?"rounded-t-[5px]":""} ${p?"rounded-b-[5px]":""}`,onClick:()=>d(o),role:"option","aria-selected":s===o,children:o},o)})})]})}function P(s,e=!0){return B({queryKey:["exhibitionVisitRecent",s],queryFn:D.exhibitionVisitRecent(s),enabled:e,staleTime:6e4,retry:!1})}const H=[{id:"1",title:"요시고 사진전",location:"서울시립미술관 서소문본관",imageUrl:q,artworkCount:9,date:"2024-10-01"},{id:"2",title:"이경준 사진전 부산",location:"서울시립미술관 서소문본관",imageUrl:j,artworkCount:5,date:"2024-09-20"},{id:"3",title:"요시고 사진전",location:"서울시립미술관 서소문본관",imageUrl:I,artworkCount:9,date:"2024-09-25"},{id:"4",title:"이경준 사진전 부산",location:"서울시립미술관 서소문본관",imageUrl:j,artworkCount:5,date:"2024-08-30"}],O=s=>(s??[]).map(e=>{const n=e.visitedAt??e.visitDate??e.startAt??e.createdAt??"2010-01-01";return{id:String(e.exhibitionId),title:e.exhibitionTitle,location:e.gallery,imageUrl:R(e.exhibitionImage??""),artworkCount:e.artCount,date:n}});function K(){const[s,e]=l.useState(""),[n,a]=l.useState("전체"),[r,c]=l.useState("최신순"),d=$(),o=i=>d(`/gallery/${i}`),[m,g]=l.useState(!0);l.useEffect(()=>{const i=setTimeout(()=>g(!1),300);return()=>clearTimeout(i)},[]);const k=s.trim()||void 0,C=n==="즐겨찾기"?!0:void 0,S=r==="최신순"?"RECENT":"DATE",{data:x,isFetching:N}=P({keyword:k,isBookmarked:C,sort:S,page:0,limit:24},!0),h=l.useMemo(()=>{const i=x==null?void 0:x.items,u=O(i);return u.length>0?u:H},[x]),E=l.useMemo(()=>{const i=u=>u==="2010-01-01";return[...h].sort((u,f)=>{const y=i(u.date),F=i(f.date);if(y!==F)return y?1:-1;const v=new Date(u.date).getTime(),w=new Date(f.date).getTime();return r==="최신순"?w-v:v-w})},[h,r]),b=m||N;return t.jsxs("main",{className:"flex min-h-screen w-full flex-col pb-8","aria-busy":b,children:[t.jsx(L,{title:"나의 전시",backgroundColorClass:"bg-gray-5",showBackButton:!0}),t.jsxs("section",{className:"flex flex-col gap-[1.6rem] px-[2.4rem]",children:[t.jsx(V,{value:s,onChange:e}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(U,{filter:n,onFilterChange:a}),t.jsx("div",{className:"flex-1"}),t.jsx(G,{sort:r,onChange:i=>c(i),options:["최신순","날짜순"]})]})]}),t.jsx(A,{onSelect:o,exhibitions:E,isLoading:b})]})}export{K as default};
