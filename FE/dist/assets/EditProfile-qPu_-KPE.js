import{r as a,b as R,j as e,k as v,l as ee,H as se}from"./index-D9A7aE9K.js";import{L as ae}from"./index.es-gKbkHIxA.js";import{e as te}from"./edit-profile-CpGNGWBS.js";import{B as u}from"./Button-T2aSqsrt.js";import{P as k,T as Q}from"./TextInput-_vXLQGST.js";import{u as b,m as ne}from"./mutationFactory-BVCIUn7Z.js";function re(){return b({mutationFn:t=>ne.verifyPassword(t)})}function ce({onSuccess:t}){const[n,s]=a.useState(""),[r,l]=a.useState(""),i=re(),{showToast:o}=R(),g=()=>{if(!n){o("비밀번호를 입력해주세요.","error");return}i.mutate(n,{onSuccess:m=>{m.verified?(l(""),o("인증이 완료되었습니다.","success"),t(m.userInfo)):o("비밀번호가 일치하지 않습니다.","error")},onError:()=>o("비밀번호가 일치하지 않습니다.","error")})};return e.jsxs("section",{className:"flex flex-col gap-[6rem]",children:[e.jsxs("div",{className:"flex flex-col items-center gap-[1.6rem] pt-[5rem]",children:[e.jsx(ae,{autoplay:!0,loop:!0,animationData:te,className:"w-[12.5rem]"}),e.jsxs("div",{className:"flex flex-col items-center gap-[0.8rem] text-gray-100",children:[e.jsx("span",{className:"t3",children:"비밀번호를 입력해주세요"}),e.jsx("span",{className:"bd2",children:"개인정보 보호를 위해 비밀번호 확인이 필요합니다."})]})]}),e.jsxs("div",{className:"flex flex-col gap-[4rem] px-[2.5rem]",children:[e.jsx(k,{placeholder:"비밀번호",value:n,onChange:m=>{s(m.target.value),r&&l("")},errorMessage:r}),e.jsx(u,{className:"bg-brand-blue bt1",onClick:g,disabled:i.isPending,"aria-busy":i.isPending,children:"다음"})]})]})}async function le(t){return(await v.patch("/api/v1/users/me/login-id",t)).data}function ie(){return b({mutationFn:le})}async function oe(t){return(await v.patch("/api/v1/users/me/nickname",t)).data}function de(){return b({mutationFn:oe})}async function ue(t){return(await v.patch("/api/v1/users/me/pw",t)).data}function me(){return b({mutationFn:ue})}const A=["users","me"];function K(t,n){var l,i;const s=t,r=(l=s==null?void 0:s.response)==null?void 0:l.data;return((i=r==null?void 0:r.result)==null?void 0:i[n])||(r==null?void 0:r.message)||"요청을 처리하지 못했습니다."}function fe(t){var r,l;const n=t,s=(r=n==null?void 0:n.response)==null?void 0:r.data;return((l=s==null?void 0:s.result)==null?void 0:l.updatePassWordRequest)||(s==null?void 0:s.message)||"요청을 처리하지 못했습니다."}function xe({initialNickname:t,initialUserId:n}){const{showToast:s}=R(),r=ee(),[l,i]=a.useState(!1),[o,g]=a.useState(!1),[m,C]=a.useState(!1),[f,V]=a.useState(t),[x,H]=a.useState(n),[p,P]=a.useState(""),[h,E]=a.useState(""),[I,S]=a.useState(t),[U,L]=a.useState(n);a.useEffect(()=>S(t),[t]),a.useEffect(()=>L(n),[n]);const j=a.useMemo(()=>f.trim()!==I.trim(),[f,I]),w=a.useMemo(()=>x.trim()!==U.trim(),[x,U]),{mutateAsync:M,isPending:N}=de(),{mutateAsync:q,isPending:y}=ie(),{mutateAsync:F,isPending:T}=me(),Y=a.useCallback(c=>V(c.target.value),[]),_=a.useCallback(c=>H(c.target.value),[]),$=a.useCallback(c=>P(c.target.value),[]),D=a.useCallback(c=>E(c.target.value),[]),W=a.useCallback(()=>i(!0),[]),z=a.useCallback(()=>g(!0),[]),G=a.useCallback(()=>C(!0),[]),B=a.useCallback(()=>C(!1),[]),J=a.useCallback(async()=>{if(!j){i(!1);return}const c=f.trim();try{await M({nickname:c}),S(c),i(!1),s("닉네임이 수정되었습니다.","success"),r.invalidateQueries({queryKey:A})}catch(d){s(K(d,"nickname"),"error")}},[j,f,M,s,r]),O=a.useCallback(async()=>{if(!w){g(!1);return}const c=x.trim();try{await q({loginId:c}),L(c),g(!1),s("아이디가 수정되었습니다.","success"),r.invalidateQueries({queryKey:A})}catch(d){s(K(d,"loginId"),"error")}},[w,x,q,s,r]),X=a.useCallback(async()=>{const c=p.trim(),d=h.trim();if(!c||!d){s("비밀번호를 입력해 주세요.","error");return}if(c!==d){s("비밀번호가 일치하지 않습니다.","error");return}try{await F({password:c,confirmPassword:d}),P(""),E(""),B(),s("비밀번호가 수정되었습니다.","success")}catch(Z){s(fe(Z),"error")}},[p,h,F,B,s]);return e.jsxs("section",{className:"flex flex-col gap-[2.4rem] px-[2.4rem] py-[4rem]",children:[e.jsxs("h2",{className:"flex flex-col gap-[0.4rem] text-gray-80 t3",children:[e.jsx("span",{children:"Eyedia에서 새롭게 사용할"}),e.jsx("span",{children:"정보를 입력해 주세요."})]}),e.jsxs("div",{className:"flex flex-col gap-[2rem]",children:[e.jsxs("section",{className:"flex flex-col gap-[0.8rem]",children:[e.jsx("span",{className:"text-gray-60 ct4",children:"닉네임"}),e.jsxs("div",{className:"flex items-start justify-between gap-[0.6rem]",children:[e.jsx("div",{className:"flex flex-[3] flex-col gap-[0.4rem]",children:e.jsx(Q,{id:"nickname",value:f,onChange:Y,placeholder:"새 닉네임 입력",disabled:!l||N})}),e.jsx("div",{className:"flex-[1]",children:l?e.jsx(u,{className:"w-full bg-brand-blue",onClick:J,disabled:!f.trim()||N||!j,children:N?"저장중…":"완료"}):e.jsx(u,{className:"w-full bg-brand-blue",onClick:W,children:"변경하기"})})]})]}),e.jsxs("section",{className:"flex flex-col gap-[0.8rem]",children:[e.jsx("span",{className:"text-gray-60 ct4",children:"아이디"}),e.jsxs("div",{className:"flex items-start justify-between gap-[0.6rem]",children:[e.jsx("div",{className:"flex flex-[3] flex-col gap-[0.4rem]",children:e.jsx(Q,{id:"user-id",value:x,onChange:_,placeholder:"새 아이디 입력",disabled:!o||y})}),e.jsx("div",{className:"flex-[1]",children:o?e.jsx(u,{className:"w-full bg-brand-blue",onClick:O,disabled:!x.trim()||y||!w,children:y?"저장중…":"완료"}):e.jsx(u,{className:"w-full bg-brand-blue",onClick:z,children:"변경하기"})})]})]}),e.jsxs("section",{className:"flex flex-col gap-[0.8rem]",children:[e.jsx("span",{className:"text-gray-60 ct4",children:"비밀번호"}),e.jsx("div",{className:"flex flex-col gap-[0.8rem]",children:m?e.jsxs("div",{className:"flex flex-col gap-[1rem]",children:[e.jsx(k,{id:"password",placeholder:"새 비밀번호",value:p,onChange:$}),e.jsx(k,{placeholder:"새 비밀번호 확인",value:h,onChange:D}),e.jsx(u,{className:"bg-brand-blue",onClick:X,disabled:!p.trim()||!h.trim()||p!==h||T,children:T?"저장중…":"완료"})]}):e.jsx(u,{id:"change-password",className:"w-full bg-brand-blue",onClick:G,children:"비밀번호 변경하기"})})]})]})]})}function Ne(){const[t,n]=a.useState("verify"),[s,r]=a.useState(null);return e.jsxs("main",{className:"flex w-full flex-col",children:[e.jsx(se,{title:"내 정보 수정",showBackButton:!0,backgroundColorClass:"bg-gray-5"}),t==="verify"?e.jsx(ce,{onSuccess:l=>{r(l),n("edit")}}):e.jsx(xe,{initialNickname:(s==null?void 0:s.username)??"",initialUserId:(s==null?void 0:s.id)??""})]})}export{Ne as default};
